name: Auto Increment Version

on:
 pull_request_review:
    types: [submitted]

jobs:
  increment:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0 # otherwise, you will failed to push refs to dest repo

    - name: Get current version
      id: version
      uses: notiz-dev/github-action-json-property@release
      with:
        path: 'config.json'
        prop_path: 'mergeVersion'

    - name: New Version
      id: newVersion
      run: echo "::set-output name=newVersionNumber::$((${{steps.version.outputs.prop}}+1))"

    - name: Get Branch Name
      uses: tj-actions/branch-names@v4.8
      id: branchName
     
    - name: Atualizar versao
      uses: jossef/action-set-json-field@v1
      with:
        file: config.json
        field: mergeVersion
        value: ${{ steps.newVersion.outputs.newVersionNumber }}
        
    - name: Commita as mudancas
      run: |
            git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git config --local user.name "github-actions[bot]"
            git commit -m "Auto increment version" -a
                       
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ steps.branchName.outputs.current_branch }}
